{% extends "base.html" %}
{% block title %}Add Cat{% endblock %}
{% block content %}
  <h1>Add a Cat</h1>
  <form id="add-cat-form" action="{{ backend_url }}/inpaint" method="post" enctype="multipart/form-data">
    <div>
      <label for="image">Upload Image:</label>
      <input type="file" id="image" name="image" accept="image/*" required>
    </div>
    <div style="margin:1rem 0;">
      <label>Draw Mask:</label>
      <canvas id="mask-canvas" width="512" height="512"
              style="border:1px solid #ccc; display:block; margin-bottom:0.5rem;"></canvas>
      <input type="hidden" id="mask-data" name="mask">
    </div>
    <div style="margin-bottom:1rem;">
      <label for="description">Cat Description:</label><br>
      <textarea id="description" name="description" rows="3" required
                style="width:100%;"></textarea>
    </div>
    <button type="submit"
            style="background:#243447; color:white; padding:0.75rem 1.5rem; border:none;
                   border-radius:4px; cursor:pointer; font-weight:bold; text-transform:uppercase;
                   letter-spacing:0.05em;">
      Generate
    </button>
  </form>

  <script>
    // Simple mask capture: on click/toggle draw, then serialize to PNG
    const canvas = document.getElementById('mask-canvas');
    const ctx = canvas.getContext('2d');
    let drawing = false;
    canvas.addEventListener('mousedown', () => drawing = true);
    canvas.addEventListener('mouseup', () => drawing = false);
    canvas.addEventListener('mousemove', e => {
      if (!drawing) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left, y = e.clientY - rect.top;
      ctx.fillStyle = 'black';
      ctx.fillRect(x-5, y-5, 10, 10);
    });
    document.getElementById('add-cat-form').addEventListener('submit', e => {
      document.getElementById('mask-data').value = canvas.toDataURL();
    });
  </script>
{% endblock %}
